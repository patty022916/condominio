<app-buttons-header (addEvent)="openModal()"></app-buttons-header>

<section class="main-form">

	<mat-card>
		<mat-card-content>
			<mat-card-title>Listado de Cuotas </mat-card-title>

			<div class="table-responsive">
				<!-- Filtrado de la tabla -->
				<div class="row">
					<div class="col-lg-6">
						<!-- input -->
						<mat-form-field appearance="outline" class="w-100" color="primary">
							<input (keyup)="filtro($event)" matNativeControl type="search" />
						</mat-form-field>
					</div>
				</div>
				<table mat-table [dataSource]="dataSource" class="w-100">


					<ng-container matColumnDef="monto">
						<th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-15 p-l-0">
							Monto total
						</th>
						<td mat-cell *matCellDef="let value" class="p-l-0">
							<h6 class="f-s-14 f-w-600">
								{{ value.monto }}$
							</h6>
						</td>
					</ng-container>

					<ng-container matColumnDef="fecha">
						<th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-15 p-l-0">
							Mes de gasto
						</th>
						<td mat-cell *matCellDef="let value" class="p-l-0">
							<h6 class="f-s-14 f-w-600">
								{{ value.fecha| date:'dd/MM/yyyy' }}
							</h6>
						</td>
					</ng-container>

					<ng-container matColumnDef="created_at">
						<th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-15 p-l-0">
							Fecha de creación
						</th>
						<td mat-cell *matCellDef="let value" class="p-l-0">
							<h6 class="f-s-14 f-w-600">
								{{ value.created_at | date:'dd/MM/yyyy' }}
							</h6>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="columnas"></tr>
					<tr mat-row *matRowDef="let row; columns: columnas"></tr>
					<!-- Symbol Column -->
					<ng-container matColumnDef="budget">
						<th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-14"></th>

						<td mat-cell *matCellDef="let element">
							<button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
								<mat-icon>more_vert</mat-icon>
							</button>
							<mat-menu #menu="matMenu">
								<button (click)="openModal(element)" mat-menu-item>
									<mat-icon>visibility</mat-icon>
									<span>ver detalles</span>
								</button>
								<button (click)="eliminarCuota(element.id)" mat-menu-item>
									<mat-icon>delete</mat-icon>
									<span>Eliminar</span>
								</button>
							</mat-menu>
						</td>
					</ng-container>

				</table>
				<!-- Paginator -->
				<mat-paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons>
				</mat-paginator>
			</div>
		</mat-card-content>
	</mat-card>
</section>


<ng-template #dialogTemplate>
	<h2 mat-dialog-title>Generar Cuota</h2>
	<mat-dialog-content class="blue_theme">
		<div class="row">
			<div class="col-12">
				<mat-label class="f-w-600 m-b-8 d-block">Mes de la cuota</mat-label>
				<mat-form-field appearance="outline" class="w-100" color="primary">
					<input (dateChange)="generarCuota($event)" [(ngModel)]="cuota.fecha" matInput [matDatepicker]="picker" />
					<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
					<mat-datepicker #picker></mat-datepicker>
				</mat-form-field>
			</div>
		</div>

		<div class="row">
			<h3 class="col-12 m-b-20">Cuota generada según los gastos del dia <span class="text-primary">{{ cuota.fecha |
					date:
					'dd/MM/yyyy'}}</span></h3>

			<!-- Desglose de gastos generales -->
			<div class="col-md-4 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column">
					<span>Gastos Fijos</span>
					<span class="f-w-800">{{ cuota.gasto_fijo }}$</span>
				</div>
			</div>
			<div class="col-md-4 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column align-items-start justify-content-center ">
					<span>Gastos Comunes</span>
					<span class="f-w-800">{{ cuota.gasto_comun }}$</span>
				</div>
			</div>
			<div class="col-md-4 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column">
					<span class="f-s-12">Gastos Extraordinarios</span>
					<span class="f-w-800 ">{{ cuota.gasto_extraordinario }}$</span>
				</div>
			</div>

			<div class="col-12 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column">
					<span>Gastos totales</span>
					<span class="f-w-800 ">{{ cuota.gasto_total }}$</span>
				</div>
			</div>

		</div>

		<!-- Cuotas con apartamentos -->
		<div class="row m-t-30">
			<h3 class="col-12 text-primary">Cuotas por apartamentos</h3>

			@for (ap of getCuotaApartamentos; track $index) {

			<div class="col-3 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column">
					<span class="f-s-12">Alícuota aplicada</span>
					<span class="f-w-800 ">{{ ap.coef_alicuota }}$</span>
				</div>
			</div>
			<div class="col-3 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column">
					<span class="f-s-12">Extraordinaria</span>
					<span class="f-w-800 ">{{ ap.cuota_extraordinaria_usd }}$</span>
				</div>
			</div>
			<div class="col-3 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column">
					<span>Fija</span>
					<span class="f-w-800 ">{{ ap.cuota_fija_usd }}$</span>
				</div>
			</div>

			<div class="col-3 shadow-sm border-rounded p-16">
				<div class="d-flex flex-column">
					<span>Total</span>
					<span class="f-w-800 ">{{ ap.total_bs }}Bs</span>
				</div>
			</div>
			}

		</div>
		<app-loading [loading]="loadingModal"></app-loading>
	</mat-dialog-content>
	<mat-dialog-actions class="blue_theme" align="end">
		<button (click)="dialogRef.close(this.dialogTemplate)" mat-flat-button class="danger-btn">
			cancelar
		</button>
		@if (cuota.id == 0) {
		<button (click)="guardarCuota()" mat-flat-button color="primary" matBadgeColor="accent">
			Guardar
		</button>
		}
	</mat-dialog-actions>
</ng-template>

<app-loading [loading]="loading"></app-loading>